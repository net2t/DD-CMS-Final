"\"\"\"Login utilities extracted from browser.py\"\"\"\n+\n+import time\n+from selenium.webdriver.common.by import By\n+from selenium.webdriver.support.ui import WebDriverWait\n+from selenium.webdriver.support import expected_conditions as EC\n+\n+from config.config_common import Config\n+from .browser_manager import save_cookies, load_cookies, log_msg\n+\n+\n+class LoginManager:\n+    \"\"\"Handles DamaDam login\"\"\"\n+\n+    def __init__(self, driver):\n+        self.driver = driver\n+\n+    def login(self):\n+        \"\"\"Attempt login with saved cookies or credentials\"\"\"\n+        log_msg(\"Starting authentication...\", \"LOGIN\")\n+\n+        try:\n+            if self._try_cookie_login():\n+                return True\n+\n+            return self._fresh_login()\n+\n+        except Exception as e:\n+            log_msg(f\"Login failed: {e}\", \"ERROR\")\n+            return False\n+\n+    def _try_cookie_login(self):\n+        log_msg(\"Attempting cookie-based login...\", \"LOGIN\")\n+\n+        try:\n+            self.driver.get(Config.HOME_URL)\n+            time.sleep(2)\n+\n+            if not load_cookies(self.driver):\n+                return False\n+\n+            self.driver.refresh()\n+            time.sleep(3)\n+\n+            if 'login' not in self.driver.current_url.lower():\n+                log_msg(\"Cookie login successful\", \"OK\")\n+                return True\n+\n+            return False\n+\n+        except Exception as e:\n+            log_msg(f\"Cookie login failed: {e}\")\n+            return False\n+\n+    def _fresh_login(self):\n+        log_msg(\"Starting fresh login...\", \"LOGIN\")\n+\n+        try:\n+            self.driver.get(Config.LOGIN_URL)\n+            time.sleep(3)\n+\n+            if self._try_account(Config.DAMADAM_USERNAME, Config.DAMADAM_PASSWORD, \"Primary\"):\n+                save_cookies(self.driver)\n+                log_msg(\"Fresh login successful\", \"OK\")\n+                return True\n+\n+            if Config.DAMADAM_USERNAME_2 and Config.DAMADAM_PASSWORD_2:\n+                if self._try_account(Config.DAMADAM_USERNAME_2, Config.DAMADAM_PASSWORD_2, \"Secondary\"):\n+                    save_cookies(self.driver)\n+                    log_msg(\"Fresh login successful (secondary)\", \"OK\")\n+                    return True\n+\n+            return False\n+\n+        except Exception as e:\n+            log_msg(f\"Fresh login failed: {e}\", \"ERROR\")\n+            return False\n+\n+    def _try_account(self, username, password, label):\n+        log_msg(f\"Attempting login with {label} account...\", \"LOGIN\")\n+\n+        try:\n+            nick = WebDriverWait(self.driver, 8).until(\n+                EC.presence_of_element_located(\n+                    (By.CSS_SELECTOR, \"#nick, input[name='nick']\")\n+                )\n+            )\n+\n+            try:\n+                pw = self.driver.find_element(By.CSS_SELECTOR, \"#pass, input[name='pass']\")\n+            except:\n+                pw = WebDriverWait(self.driver, 8).until(\n+                    EC.presence_of_element_located(\n+                        (By.CSS_SELECTOR, \"input[type='password']\")\n+                    )\n+                )\n+\n+            btn = self.driver.find_element(By.CSS_SELECTOR, \"button[type='submit'], form button\")\n+\n+            nick.clear()\n+            nick.send_keys(username)\n+            time.sleep(0.5)\n+\n+            pw.clear()\n+            pw.send_keys(password)\n+            time.sleep(0.5)\n+\n+            btn.click()\n+            time.sleep(4)\n+\n+            if 'login' not in self.driver.current_url.lower():\n+                log_msg(f\"{label} account login successful\", \"OK\")\n+                return True\n+\n+            log_msg(f\"{label} account login failed\", \"LOGIN\")\n+            return False\n+\n+        except Exception as e:\n+            log_msg(f\"{label} account error: {e}\", \"LOGIN\")\n+            return False\n*** End Patch**
